#!/bin/bash
my_dir="$(dirname "$0")"
. "$my_dir/common"

# Init cluster configuration
cluster_mode=`leader-get cluster_mode`
if [ -z "$cluster_mode" ]; then
	leader-set ready_standbies=" " mdm_ips=$MY_IP manager_count=0 tb_count=0 cluster_mode=1
	juju-log "ScaleIO single-node cluster creating (name: $MY_NAME, ip: $MY_IP)"
	server-cmd "class { 'scaleio::mdm_server': master_mdm_name=>'$MY_NAME', mdm_ips=>'$MY_IP', is_manager=>1 }"
	juju-log "ScaleIO single-node cluster created"
	server-cmd "scaleio::login { 'first login': password=>'admin' }"
	server-cmd "class { 'scaleio::cluster': password=>'admin', new_password=>'$MY_PASSWORD' }"
	juju-log "ScaleIO cluster password changed"
fi
